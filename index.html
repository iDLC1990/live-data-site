<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Статистика по статусам</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
  </style>
</head>
<body>

<h1>Статистика по статусам на текущий день</h1>

<table id="stats-table">
  <thead>
    <tr>
      <th>Имя</th>
      <th>ndf</th>
      <th>OK</th>
      <th>WAITING</th>
      <th>SCRAP TTL</th>
      <th>SCRAP PNLA</th>
      <th>Suma Całkowita</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const sheetID = '16MNddQGaidy__FBtRFeiw6HxRDQojBW2_c8Qznt62O8';
  const apiKey = 'AIzaSyCP7tzYiGwIZ6cymLAlv_9QgPIEshnRgqI';
  const range = 'live data!E2:H';

  const today = new Date().toISOString().split('T')[0];

  fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetID}/values/${range}?key=${apiKey}`)
    .then(res => res.json())
    .then(data => {
      const stats = {};

      data.values.forEach(row => {
        const [status, name, , date] = row;
        if (!status || !name || !date) return;
        if (date.trim() !== today) return;

        if (!stats[name]) {
          stats[name] = { ndf: 0, OK: 0, WAITING: 0, 'SCRAP TTL': 0, 'SCRAP PNLA': 0, total: 0 };
        }

        if (stats[name][status] !== undefined) {
          stats[name][status]++;
          stats[name].total++;
        }
      });

      const tbody = document.querySelector('#stats-table tbody');
      Object.entries(stats).forEach(([name, values]) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${name}</td>
          <td>${values.ndf}</td>
          <td>${values.OK}</td>
          <td>${values.WAITING}</td>
          <td>${values['SCRAP TTL']}</td>
          <td>${values['SCRAP PNLA']}</td>
          <td>${values.total}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error('Ошибка загрузки данных:', err);
    });
</script>

</body>
</html>
